# Hermione

Инструмент с открытым исходным кодом для автоматизации интеграционного тестирования веб-приложений.

## Настройка

Для начала работы нужно создать в корне файл  ```.hermione.my-conf.js```. Пример файла конфига находится там же в корне проекта.

Поле ```baseUrl``` в конфиге — адрес тестируемого приложения. Должен быть доступен для браузеров грида.

Поле ```gridUrl``` — адрес запущенного selenium-grid.

Есть два варианта работы - с локальным гридом или с удалённым. Об этом дальше.

## Грид

Для работы Гермионы используется Selenium-грид. "Безголовые" браузеры запускаются в фоне в командной строке.

### Локальный грид

В npm пакетах уже есть `selenium-standalone`. Для его работы нужно:
- в конфиге в параметре `baseUrl` можно указывать локальный адрес типа `http://dialog.local/app_dev.php/`
- указать в конфиге `gridUrl: 'http://localhost:4444/wd/hub'`
- выполнить в папке проекта команду `selenium-standalone install` (один раз)
- запустить Selenium командой `seleniustandalone start`
- Гермиона готова к работе; для запуска тестов выполнить `hermione`

### Удаленный грид

Запускать на своей машине и СЭД и браузеры, его тестирующие может оказаться накладно по ресурсам. Также существует проблема неодинакового рендера на разных ОС (падают тесты по скриншотам). Соответственно имеет смысл поднимать Selenium на удалённой машине.

В данный момент настроенный selenium-сервер есть по адресу `10.10.10.116`.

Настройка Гермионы на работу с этим удалённым сервером:
- В конфиге в параметре `baseUrl` нужно указывать адрес angular dev-сервера, доступный извне (типа `http://10.10.10.xx:4200/`).
- указать в конфиге `gridUrl: 'http://10.10.10.116:4444/wd/hub'`
- Гермиона готова к работе; для запуска тестов выполнить `hermione --set conv` (где conv - имя тестируемой платформы)

## Документация

Основная документация лежит на гитхабе на [странице проекта](https://github.com/gemini-testing/hermione).

Так как Гермиона - форк webdriver.io, то документацию по основным командам можно найти на [webdriver.io](https://webdriver.io/docs/api.html). Сигнатура несколько отличается, но общую суть, опираясь на документацию и уже написанные тесты, понять можно.

Список команд webdriver.io и Hermione совпадают не полностью. Окончательно верную информацию по командам всегда можно посмотреть в коде Гермионы в папке `node_modules/@gemini-testing/webdriverio/build/lib/commands/`.

В качестве фреймворка тестирования используется [mocha](https://mochajs.org/). Тут всё просто: каждый `it` - это тесткейс. `it` группируются внутри `describe`. `describe` можно вкладывать внутрь других `describe` для наведения иерархии и порядка.

В связке с mocha используется `assert` из [chai](https://www.chaijs.com/api/assert/). Очень мощная и удобная штука.

## Свои команды

Для избежания фатальной копипасты повторяющиеся действия можно (и нужно) выносить в кастомные команды. Для создания собственной команды нужно добавить файлик в папку `hermione/commands` по примеру уже там существующих и зарегистрировать его в `.hermione.conf.js`.

## Полезные ссылки

- https://yandex.ru/dev/hermione/
- https://github.com/gemini-testing/hermione
- https://webdriver.io/
- https://mochajs.org/ (работает через vpn)
- https://www.chaijs.com/api/assert/
