# FIXME: починить в рамках задачи #616
@skip()
Feature: Определяющий запрос

  https://dev.azure.com/programgeoplan/GIS%20Platform/_wiki/wikis/GIS-Platform.wiki/137/Свойства-объекта-схемы?anchor=definitionquery
  В сценариях используется заготовленная схема "С определяющим запросом", у которой в одном из представлений включен definitionQuery "shape_area > 200000000". Под этот фильтр подходят два из трех заготовленных объектов.

  Background:
    Given все проекты удалены
    *     все наборы данных удалены
    *     существует заготовленная схема "С определяющим запросом"
    *     существует набор данных, созданный пользователем "Гарри"
    *     внутри созданного набора данных существует таблица по схеме "С определяющим запросом" созданная пользователем "Гарри"
    *     таблица наполнена данными "для простой фильтрации"
    *     существует проект, созданный пользователем "Гарри"
    *     в созданном проекте создан слой "Тестовый" на основе созданных набора данных и таблицы
    *     в текущий проект подключена пустая подложка

  Scenario: На карте отображаются все объекты слоя, если definitionQuery фильтр не используется в выбранном представлении
    Given у данного слоя включено представление "Без определяющего запроса"
    *     я авторизован как "Гарри"
    *     я на странице карты проекта, спозиционированной на объектах слоя "Тестовый": "1", "2"
    When  я дожидаюсь исчезновения индикатора загрузки карты в шапке страницы
    Then  на карте отображаются "все три объекта"

  Scenario: На карте отображаются только те объекты слоя, которые подходят под условие definitionQuery, в выбранном представлении
    Given у данного слоя включено представление "С определяющим запросом"
    *     я авторизован как "Гарри"
    *     я на странице карты проекта, спозиционированной на объектах слоя "Тестовый": "1", "2"
    When  я дожидаюсь исчезновения индикатора загрузки карты в шапке страницы
    Then  на карте отображаются "два больших объекта"

  Scenario: Объекты слоя, не удовлетворяющие definitionQuery, невозможно выбрать на карте
    Given у данного слоя включено представление "С определяющим запросом"
    *     я авторизован как "Гарри"
    *     я на странице карты проекта, спозиционированной на объектах слоя "Тестовый": "1", "2"
    When  я дожидаюсь исчезновения индикатора загрузки карты в шапке страницы
    *     я протыкаю карту в центре
    # в центре карты находился объект "Маленький", отфильтрованный definitionQuery
    Then  не открывается форма просмотра объекта

  Scenario: В атрибутивной таблице отображаются все объекты слоя, если definitionQuery фильтр не используется в выбранном представлении
    Given у данного слоя включено представление "Без определяющего запроса"
    *     я авторизован как "Гарри"
    *     я на странице карты проекта, спозиционированной на объектах слоя "Тестовый": "1", "2"
    *     открыта атрибутивная таблица слоя "Тестовый"
    Then  в атрибутивной таблице в колонке "Наименование" значения: "Большой", "Тоже большой", "Маленький"

  Scenario: Объекты слоя, не удовлетворяющие definitionQuery, не отображаются в атрибутивной таблице
    Given у данного слоя включено представление "С определяющим запросом"
    *     я авторизован как "Гарри"
    *     я на странице карты проекта, спозиционированной на объектах слоя "Тестовый": "1", "2"
    *     открыта атрибутивная таблица слоя "Тестовый"
    Then  в атрибутивной таблице в колонке "Наименование" значения: "Большой", "Тоже большой"

  Scenario: К объектам слоя, не удовлетворяющим definitionQuery, невозможно перейти по ссылке
    Given у данного слоя включено представление "С определяющим запросом"
    *     я авторизован как "Гарри"
    *     я на странице карты проекта, спозиционированной на объектах слоя "Тестовый": "3"
    When  я дожидаюсь исчезновения индикатора загрузки карты в шапке страницы
    Then  не открывается форма просмотра объекта
