<div *ngIf="data.results.length < 1 && data.validated && !isLoadingResults">
  <div *ngIf="data.status === 'DONE'">
    <h6
      class="float-left"
      style="
        padding-left: 10px;

        font-size: inherit;
"
      *ngIf="!!data.validated"
    >
      Ошибок нет
    </h6>
    <h6
      class="float-left"
      style="
        padding-left: 10px;

        font-size: inherit;
"
      *ngIf="!data.validated"
    >
      Проверка данных не выполнялась
    </h6>
    <h6
      class="float-right"
      style="
        padding-right: 10px;

        font-size: inherit;
"
      *ngIf="!!data.lastValidated"
    >
      Время последней проверки: {{ data.lastValidated }}
    </h6>
  </div>
  <div *ngIf="data.status === 'ERROR'">
    <h6 class="float-left" style="font-size: inherit;">Ошибка проверки данных</h6>
  </div>
</div>

<div class="validation-results-container mat-elevation-z8" [hidden]="data.results?.length === 0 && !isLoadingResults">
  <div class="example-loading-shade" *ngIf="isLoadingResults">
    <mat-spinner></mat-spinner>
  </div>

  <div [hidden]="data.results?.length === 0">
    <div class="validation-results-table-container scroll">
      <table
        mat-table
        [dataSource]="data.results"
        class="example-table"
        multiTemplateDataRows
        matSort
        matSortActive="objectid"
      >
        <ng-container matColumnDef="objectid">
          <th mat-header-cell *matHeaderCellDef mat-sort-header style="padding-left: 34px;">ID</th>
          <td mat-cell *matCellDef="let element">
            <button mat-icon-button (click)="showObject($event, element.objectId)">
              <mat-icon style="color: yellowgreen;">search</mat-icon>
            </button>
            <button *ngIf="updatingAllowed" mat-icon-button (click)="editObject($event, element.objectId)">
              <mat-icon style="color: darkgrey;">edit</mat-icon>
            </button>
            {{ element.objectId }}
          </td>
        </ng-container>

        <ng-container matColumnDef="classid">
          <th mat-header-cell *matHeaderCellDef style="padding-left: 10px;">Название</th>
          <td mat-cell *matCellDef="let element" style="padding-left: 10px;">{{ element.title }}</td>
        </ng-container>

        <ng-container matColumnDef="violationsCounter">
          <th mat-header-cell *matHeaderCellDef>Ошибок</th>
          <td mat-cell *matCellDef="let element">
            <span class="violations-counter">
              {{ element.propertyViolations.length + element.objectViolations.length }}
            </span>
            <div class="float-right" style="color: grey;">
              <button mat-icon-button *ngIf="element != expandedElement">
                <mat-icon>keyboard_arrow_down</mat-icon>
              </button>
              <button mat-icon-button *ngIf="element == expandedElement"><mat-icon>keyboard_arrow_up</mat-icon></button>
            </div>
          </td>
        </ng-container>

        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
        <ng-container matColumnDef="expandedDetail">
          <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
            <div class="example-element-detail" [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
              <crg-violations-view [data]="element" [layer]="crgLayer" style="width: 100%;"></crg-violations-view>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true" style="height: 20px;"></tr>
        <tr
          mat-row
          *matRowDef="let element; columns: displayedColumns"
          class="example-element-row"
          [class.example-expanded-row]="expandedElement === element"
          (click)="expandedElement = expandedElement === element ? null : element"
        ></tr>

        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
      </table>
    </div>
  </div>

  <mat-paginator [length]="totalElements" [pageSize]="defaultPageSize"></mat-paginator>
</div>
